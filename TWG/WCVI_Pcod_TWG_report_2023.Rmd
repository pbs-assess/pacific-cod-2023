---
title: "Alternative treatments of the commercial annual mean weight index for the West Coast Vancouver Island stock of Pacific Cod. Report for the Technical Working Group."
author: "Robyn Forrest and Sean Anderson"
date: "June 21, 2023"
link-citations: true
bibliography: bib/refs.bib
csl: bib/csas.csl
documentclass: article
geometry: margin=2.3cm
output:
  bookdown::pdf_document2:
    toc: yes
    fig_caption: yes
    number_sections: yes
urlcolor: blue
linkcolor: blue
---

```{r setup, echo=FALSE, cache=FALSE, message=FALSE, results='hide', warning=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  comment = "#>",
  fig.path = "knitr-figs/",
  cache.path = if (knitr:::is_latex_output()) "knitr-cache-tex/" else "knitr-cache-docx/",
  fig.asp = 0.618,
  fig.width = 6.5,
  out.width = "5in",
  echo = FALSE,
  autodep = TRUE,
  cache = TRUE,
  cache.comments = FALSE,
  dev = if (knitr:::is_latex_output()) "pdf" else "png",
  dpi = 200,
  fig.align = "center",
  fig.pos = "htb"
)
french <- FALSE
source(file.path(here::here(), "R", "all.R")) #Loading the data is in this file (or pulling it from GFBio if it doesn't exist yet)

```

```{r custom-vars, cache=TRUE, echo=FALSE, message=FALSE, results='hide'}
#NOTE. if adding sensitivity models need to modify load.models.into.parent.env()
# in model-setup.R (as well as path names to sensitivity folders)
build(ovwrt.base = FALSE,
      ovwrt.sens = FALSE,
      ovwrt.retro = FALSE,
      burnin = 1000,
      thin = 1)

load.models.into.parent.env()

source(file.path(rootd.R, "custom-knitr-variables.R")) # Making catch data objects is in this file
```

```{r setup-tables, cache=FALSE, echo=FALSE}
if(!knitr:::is_latex_output())
  options(knitr.table.format = "pandoc")
```

\clearpage

# Context

<!--
The Fish Stocks provisions (FSP) of Canada's [Fisheries Act](https://laws-lois.justice.gc.ca/eng/acts/f-14/page-2.html#h-1175547) require that a rebuilding plan be developed for major fish stocks that have declined to or below their limit reference point (LRP).
While the FSP only apply to major stocks prescribed in the *Fishery (General) Regulations*, [guidance](https://www.dfo-mpo.gc.ca/reports-rapports/regs/sff-cpd/precautionary-precaution-eng.htm#toc_2.1) has been provided, which states that, for stocks not subject to the FSP, DFO's Precautionary Approach (PA) Policy [@dfo2009] still applies:

*"[...] under the [PA] policy, the requirement to develop a rebuilding plan is triggered once the stock declines to, or below, its LRP. However, in keeping with the 2009 PA Policy, if a fish stock is decreasing and approaching the LRP, management measures must encourage stock growth and arrest preventable declines, and the development of a rebuilding plan should be initiated sufficiently in advance to ensure that the plan is ready to be implemented if a stock declines to its LRP."*

For the purpose of triggering a rebuilding plan, the guidance provides the following definitions of whether a stock is at or below its LRP:

*"[A stock] is considered to be at or below its LRP if the terminal year stock status indicator is estimated to be at or below the LRP with a greater than 50% probability or if the projected stock status indicator falls below the LRP with a greater than 50% probability under a zero catch scenario in a 1-year projection, unless an alternative method or probability is defined in a stock-specific precautionary approach framework."*
-->

The 2020 stock assessment for Pacific Cod (*Gadus macrocephalus*) found the Area 3CD (West Coast of Vancouver Island: WCVI) stock to be in the Cautious Zone with > 99% probability [@dfo2021].
This followed a notable reduction in the 2018 WCVI survey index (approximately 26--27% of the 2014 and 2016 observations (Figure \@ref(fig:surv-canadian); Table \@ref(tab:surv-canadian-table)).

Due to the COVID-19 pandemic, the scheduled 2020 WCVI Synoptic Bottom Trawl Survey was postponed to 2021, then returned to its regular biennial schedule in 2022.
Both the 2021 and 2022 index points were of a similar low magnitude to the 2018 observation (Figure \@ref(fig:surv-canadian)).
Catches from 2018--2020 were also lower than in previous years (Table \@ref(tab:tab-catch-3cd), Figure \@ref(fig:fig-catch-3cd)).
The commercial CPUE index decreased substantially in 2018 but has increased slightly since then, with increases in commercial catch (Figure \@ref(fig:fig-modern-cpue-3cd), Table \@ref(tab:tab-catch-3cd)).
Given the low index point in 2018, the 2020 Science Response recommended updating the assessment when new survey information became available [@dfo2021].

The stock assessment is a Bayesian delay-difference model [@deriso1980], fit to commercial and survey indices of abundance, commercial catch, and an index of commercial annual mean weight [@forrest2020]. The commercial mean weight index is derived from commercial length samples [see Appendix C of @forrest2020 for methodology], and provides information about recruitment strength to the model.
Due to COVID-19 and a subsequent shift towards at-sea electronic monitoring, there has been no at-sea biological sampling on commercial trawl vessels since 2019.

A Request for Science Information and Advice (RSIA) for Pacific Cod was issued in 2022 for both the 3CD and 5ABCD (Hecate Strait and Queen Charlotte Sound) stocks.
The request had two steps: 1) an evaluation to assess the potential sensitivity of the stock assessment to missing length data from the commercial fishery; and 2) update the status of both stocks.
The request advised to only proceed to Step 2 if the missing length data were "deemed to not be of significance to the quality and rigour of the scientific advice".
Using the 2020 assessment model, the authors presented several sensitivity analyses to the Pacific Cod Technical Working Group (TWG) to show the potential effects of the loss of commercial length samples on predicted stock status.
The TWG evaluated a generalized linear model (GLM) for predicting the commercial mean weight index from an annual mean weight index derived from WCVI survey samples.
The TWG found that the GLM provided a reasonable prediction of the commercial mean weight index for the Area 3CD stock.
The GLM did not have acceptable predictive power for the 5ABCD stock.
Because of this and limited staff resources, the TWG did not proceed with Step 2 of the RSIA.

Presumably due to the ongoing low catches of Area 3CD Pacific Cod and model estimates of low fishing mortality [@dfo2021], the Pacific Groundfish Management Unit did not request updated catch advice for 2023.
However, given the three low index points in 2018, 2021 and 2022, Science has requested a stock status update to ensure all three of these index points are considered in a timely evaluation of stock status.

<!--This Science Response reports results from the Science Response Process of December 2022 on the Stock Status Update of British Columbia Pacific Cod (*Gadus macrocephalus*) in Area 3CD in 2023. ADD BACK IN TO SR-->
This report evaluates four different treatments of the commercial annual mean weight index for 2018-2022 in a model configured the same as the the 2018 and 2020 reference models [@forrest2020; @dfo2021].
The different treatments of the commercial annual mean weight index include two scenarios that use recent index values derived from the GLM presented to the TWG in 2022 (Appendices B and C), and two that do not. 
We are seeking feedback on which of these scenarios to use in the models for estimation of model-averaged stock status. 

# Methods

## Data

Data were extracted from DFO databases using methods described in @forrest2020.
Data from fishery-independent and commercial fishery sources were available up until April 2023.
All time series were calculated using currently available data.
Minor differences in the time series compared to those presented in previous assessments are due to routine updates and corrections in the databases.

### Commercial catch

Commercial catch data (Table \@ref(tab:tab-catch-3cd) and Figure \@ref(fig:fig-catch-3cd)) were extracted from three different databases held by DFO: *GFCatch* (Canadian trawl landings, 1954--1995); *PacHarvTrawl* (Canadian trawl landings, 1996 to March 31, 2007); and *GFFOS* (Canadian trawl landings, April 1, 2007 to March 31, 2023).
Catch data prior to 1981 include catch by US vessels [@forrest2015; @forrest2020].
Fishing years are defined as beginning on April 1 for all years, and are referenced by starting year, e.g., fishing year 1957 runs from April 1, 1957 to March 31, 1958 [see @forrest2020].

### WCVI Synoptic bottom trawl survey

The WCVI Synpotic Survey index (Table \@ref(tab:surv-canadian-table) and Figure \@ref(fig:surv-canadian)) was calculated using a swept area analysis, documented in Appendix A of @forrest2020.
The survey was first conducted in 2004 and is conducted in alternating (even-numbered) years.
Due to the COVID-19 pandemic the 2020 survey was postponed to 2021 and then returned to its regular biennial schedule in 2022.

### NMFS Triennial Survey (in Canadian waters)

An additional relative abundance index for Area 3CD was developed using data from the
National Marine Fisheries Service (NMFS) Triennial survey, which operated off the lower half of WCVI between 1980 and 2001.
See Appendix A of @forrest2020 for details.

### Commercial CPUE

Standardized commercial CPUE indices were developed for the historical (1956--1995) and modern (1996--2022) periods.
The indices were developed using a Tweedie generalized linear mixed model (GLMM) described in Appendix B of @forrest2020.
The historical-period GLMMs included predictors for depth, locality, month, and a locality-year interaction.
The modern-period GLMMs included predictors for depth, latitude, locality, month, vessel, and a locality-year interaction (Figure \@ref(fig:fig-modern-cpue-3cd)).

### Commercial annual mean weight index

The commercial annual mean weight index was calculated using commercial length samples, with the methodology described in Appendix C of @forrest2020.
Commercial biological samples were available for calculating mean weight from 1956 to 2019 (excluding 2018).

There has been no biological sampling on commercial trawl vessels since 2019.
However, even before the COVID-19 pandemic, there had been a decline in commercial sampling of Pacific Cod, starting in 2016 (Appendix A).
In Area 3CD, only four samples were taken in 2017 (total 300 fish), no samples were taken in 2018, and only two samples were taken in 2019 (total 360 fish).
The 2017 mean weight value was anomalously high (3.024 kg) and, given that it was only based on two samples, it was not used in the 2020 stock assessment update [@dfo2021].
Due to lack of data, the 2020 assessment used the 2019 mean weight value for both 2019 and 2020, although this was not ideal, as the 2019 index point was also based on only two samples.

Therefore, a methodology was developed for predicting the commercial mean weight index from an annual mean weight index derived from WCVI Synoptic Survey length samples.
The methodology was presented to the TWG in 2022, who found it provided a reasonable fit to the commercial mean weight index derived from commercial data.

## Modelling steps

In order to investigate the sensitivity of the model to different treatments of the commercial annual mean weight index, the following steps were taken:

Step 1. Develop an annual mean weight index based on length samples from the WCVI Synoptic Survey (see Appendix B for methods and results).

Step 2. Use a GLM with gamma observation error and a log link to predict commercial annual mean weight index values from the survey annual mean weight index (see Appendix C for methods and results).

Step 3. Update model data files with new data streams, with four alternative treatments of the commercial mean weight index (see next section).

Step 4. Run the models and evaluate sensitivity of model results to treatment of the commercial mean weight index.

Step 5. Select a scenario for the commercial mean weight index to use in the seven sensitivity cases for model-averaging, run the models, and calculate model-averaged stock status.

## Model scenarios: sensitivity to treatment of the commercial mean weight index

All models were based on the Area 3CD Reference Case model from the 2020 assessment [@dfo2021].
Model settings were identical to that model but all data streams were updated to the end of the 2023-23 fishing year.
All scenarios used the commercial annual mean weight index derived from commercial length samples for the years 1956--2016.
There was no 2017 index point in any scenario, as in the 2020 assessment.
The GLM (Appendix C) predicted values for the commercial mean weight index only for years when there was a survey (i.e., predicted index values were generated for even-numbered years from 2004 to 2018, then 2021 and 2022; Figure \@ref(fig:all-mean-weight-series-3cd)).
As in previous assessments, all scenarios (except one) assumed an observation error of $\sigma_W$ = 0.2, which influences the fit to the mean weight in the likelihood function [@dfo2021].

Four sensitivity cases were explored, which differed in terms of the treatment of the commercial mean weight index for the years 2018--2022.
Values of the index used in the different scenarios since 2010 are shown in Table \@ref(tab:tab-mean-weight-recent-3cd).

Sc. 1 GLM Interpolation: For 2018--2022, use the GLM predicted values for 2018, 2021 and 2022. Use linear interpolation between 2018 and 2021 to fill in values for 2019 and 2020.

Sc. 2 GLM No interpolation: For 2018--2022, use the GLM predicted values for 2018, 2021 and 2022. Do not include values for 2019 and 2020.

Sc. 3 No GLM, with extrap: For the last seven years of the time series, use the same approach as in the 2020 assessment [@dfo2021], i.e, use the commercial mean weight index values for 2016, 2019 and 2020, where the 2020 value was set the same as the 2019 value. Continue to use the 2019 value for 2021 and 2022.

Sc 4. No GLM, no extrap: Same as Sc. 3 but do not include any values for 2021 and 2022.

For all model runs, the joint posterior distribution was numerically approximated using the Markov Chain Monte Carlo (MCMC) routines built into AD Model Builder (Metropolis-Hastings algorithm) [@fournier2012].
Posterior samples were drawn every 2,500 iterations from a chain of length 5 million, resulting in 2,000 posterior samples (the first 1,000 samples were dropped to allow for sufficient burn-in).

<!--
## Model-averaged stock status

The previous two stock assessments for 3CD Pacific Cod used a model-averaging approach to develop estimates of stock status and decision tables [@dfo2019; @dfo2021].
A set of seven model scenarios for model averaging was agreed upon at the Canadian Science Advisory Secretariat (CSAS) Regional Peer Review (RPR) meeting for the 2018 assessment [@dfo2019].

The same seven sensitivity cases from the 2018 and 2020 stock assessments were used here for model-averaging.
However, to proceed with estimating stock status using the model-averaging approach, it was necessary to select a base scenario for treatment of the commercial annual mean weight index, to use in all seven models.
This decision will ultimately be made with guidance of the TWG.
In the meantime, noting the similarity of all four mean weight index scenarios (see Results), the seven sensitivity models were set up with the same commercial mean weight index as in Sc. 1 above.

The sensitivity cases are fully described in @forrest2020, but briefly (retaining the original scenario names for all but the first scenario), they are:

1.	Sc. 1a GLM Interpolation (this is Sc. 1 from the above analyses);
2.	Sc. 2d Set the mean of the prior probability distribution for synoptic survey $\ln(q)$ = $\ln(1.0)$;
3.	Sc. 2e Increase the standard deviation (SD) for synoptic survey $\ln(q)$ to 0.6;
4.	Sc. 3a Set the parameters of the prior probability distribution for $\ln(M) \sim \mathcal{N}(\ln(0.4),0.1)$;
5.	Sc. 5a Set knife-edged age at recruitment = 3 years;
6.	Sc. 6b Reduce the overall observation error term $\sigma_O = 0.15$; and
7.	Sc. 7b Reduce the SD in the likelihood for the fit to average annual mean weight $\sigma_W = 0.15$.

As above, posterior samples were drawn every 2,500 iterations from a chain of length 5 million, resulting in 2,000 posterior samples (the first 1,000 samples were dropped to allow for sufficient burn-in).
-->

# Results

## Model scenarios: sensitivity to treatment of the commercial mean weight index

Maximum posterior density (MPD) model fits to the commercial mean weight index from the four scenarios are shown in Figures \@ref(fig:fig-base-mean-weight-3cd) to \@ref(fig:fig-base-mean-weight-3cd-sc4).
As in previous assessments [@forrest2020; @dfo2021], model fits to the mean weight index in all scenarios were generally poor for the early part of the time series, with the models tending to underestimate observed mean weight.
This is most likely because most of the length measurements in this part of the time series came from fish classified as "keepers", i.e., not released at sea (see @forrest2015 for discussion of this issue for the Area 5AB and 5CD stocks).
Smaller, released fish are therefore likely underrepresented in the annual mean weight data prior to the introduction of at-sea observers in 1996.
A scenario with a smaller value of $\sigma_W$, which influences the fit to the mean weight in the likelihood function, is included in the model-averaging set (Sc. 7b).

The models that used values from the GLM from 2018 onwards (Sc. 1 and 2) fit the commercial mean weight index well (Figures \@ref(fig:fig-base-mean-weight-3cd) and \@ref(fig:fig-base-mean-weight-3cd-sc2)).
The fit was similar for  scenarios both with and without interpolation in 2019--2020.
The models without GLM values (Sc. 3 and 4) had a poor fit to the commercial mean weight index from 2018 onwards (Figures \@ref(fig:fig-base-mean-weight-3cd-sc3) and \@ref(fig:fig-base-mean-weight-3cd-sc4)).
In these scenarios, the model-predicted commercial mean weights followed a similar pattern to those in Sc. 1 and 2, with a peak in 2018, followed by a decline.
This pattern is consistent with predicted recruitment from all four models (Table \@ref(tab:tab-est-recruit-3cd)), which estimated low recruitment between 2016 and 2018.
A population with fewer recruits is expected to have a higher than average mean weight of individuals.
The models estimated an increase in recruitment between 2019 and 2022, which would explain the subsequent estimated decline in commercial mean weight (Table \@ref(tab:tab-est-recruit-3cd), Figure \@ref(fig:fig-sens-recr-3cd)).
All four models showed a similar pattern (Table \@ref(tab:tab-est-recruit-3cd-per)), indicating that the other indices had a greater influence on model likelihoods than the commercial mean weight index, i.e., the declines in the survey index, commercial catches and commercial CPUE all pointed to low recruitment and higher mean weight in 2018 (Figures \@ref(fig:surv-canadian) to \@ref(fig:fig-modern-cpue-3cd)).
This suggests that the survey mean weight index, used to derive the commercial index in Sc. 1 and 2, is consistent with the other data sources and better indexes underlying mean weight patterns than simply extrapolating the mean weight index from earlier observations, as in Sc. 3 and 4.

Posterior biomass estimates from the four scenarios are shown in Figure \@ref(fig:fig-sens-biomass-3cd).
All four models estimated a similar pattern in biomass (Table \@ref(tab:tab-est-biomass-3cd)).
The scenarios without the GLM values (Sc. 3 and 4) estimated slightly higher biomass for 2020--2022 than Sc. 1 and 2 (Table \@ref(tab:tab-est-biomass-3cd-per)), but the maximum percentage difference was only 7.8% (Sc. 3 compared to Sc. 1 in 2021).

Given the consistency of the GLM-derived commercial mean weight index with other data sources, and the small differences in biomass estimates among scenarios (Figure \@ref(fig:fig-sens-biomass-3cd)), we recommend using Sc. 1 for all the models in the model-averaging set for estimating stock status.

<!--
## Model-averaged stock status

Sensitivity of posterior biomass estimates to the settings in the seven scenarios are shown in Figure \@ref(fig:fig-sens-biomass-3cd-all-avg).
Sensitivity of posterior recruitment estimates are shown in Figure \@ref(fig:fig-sens-recr-3cd-all-avg).
As in previous assessments, of the seven scenarios, the model was most sensitive to the assumed standard deviation in the prior for survey catchability ($q$).

Model-averaged posterior estimates for biomass and fishing mortality are shown in Figures \@ref(fig:fig-model-average-biomass-3cd) and \@ref(fig:fig-model-average-f-3cd), respectively.
While the fishing mortality is estimated to be well-below the limit removal reference, which is defined as the average fishing mortality between 1956 and 2004 [@forrest2020], there is a non-zero probability that the stock is below the limit reference point (LRP), which is defined as the estimated biomass in 1985 [@forrest2020].

As stated in the Context section, a stock is considered to be below its LRP, thereby triggering requirements for a rebuilding plan, if the terminal year biomass is estimated to be below the LRP with greater than 50% probability or if there is a greater than 50% probability of being below the LRP in a one year projection with zero catch.

Table \@ref(tab:summary-tab-stock-status-avg-3cd) indicates a 24% probability (i.e., about 1 out of 4 chance) that the biomass at the beginning of 2023 is below the LRP and >99% probability that the stock is below the USR. See also Figures \@ref(fig:fig-model-average-biomass-3cd-rel) and \@ref(fig:fig-model-average-p-lrp), noting that Figure \@ref(fig:fig-model-average-p-lrp) indicates that the models estimated just over 50% probability of the stock being below the LRP in 2021.
Table \@ref(tab:summary-tab-projection-zero-avg-3cd) indicates a 16% probability that the stock would be below the limit reference point at the beginning of 2024 under a zero catch policy.
-->

# Summary and conclusions

The survey annual mean weight index was a good predictor of the commercial annual mean weight index in Area 3CD.
The predicted commercial mean weight index followed the observed commercial mean weight index closely in most years.
Models that did not include GLM estimates of the commercial mean weight index (Sc. 3 and 4) did not fit the extrapolated mean weight index values after 2018.
This was likely because the catch data and indices of abundance provided a strong signal of low recruitment between 2017 and 2019, which reduced the influence of the commercial mean weight index on the model likelihood.

<!--
The seven models used for model averaging all used a commercial mean weight index that included values from the GLM (Sc. 1).
Model-averaged estimates of biomass indicated a 24% probability that the stock is below the LRP at the beginning of 2023, and a 16% probability that the stock would be below the LRP at the beginning of 2024 under zero catches.
Therefore, the stock does not currently meet the threshold of 50% probability of being below the LRP required under the rebuilding guidance to trigger a rebuilding plan (see Context).
However, these findings may invoke the requirement that "management measures must encourage stock growth and arrest preventable declines, and the development of a rebuilding plan should be initiated sufficiently in advance to ensure that the plan is ready to be implemented if a stock declines to its LRP."
Current fishing mortality is estimated to be low (< 0.05 $y^{-1}$) but increasing slightly, with an approximate 70% increase in commercial catch between 2021 and 2022.

Other Pacific Cod populations (notably in Alaska) have undergone large declines since the "marine heatwave" of 2015 and 2016 [e.g., @barbeaux2020; @laurel2020].
However, survey indices of abundance in other areas of BC (Hecate Strait, Queen Charlotte Sound and West Coast Haida Gwaii) have not shown similar declines.
There has not been a thorough analysis of potential causes for the current decline in the Area 3CD Pacific Cod stock, which may be related to climate change, poor egg hatching survival, declines in body condition, movement, fishing, or other factors.
We recommend that resources be allocated to investigate alternative hypotheses for changes in abundance of Pacific Cod in BC waters.

The loss of commercial biological samples from the commercial trawl fishery threatens the long-term viability of the current delay-difference model as a primary tool for assessing BC Pacific Cod populations.
Given the poor predictive power of the GLM for predicting a commercial mean weight index for the Area 5ABCD population (unpublished), there is already no clear path forward for that stock.
Therefore, in the absence of resuming a full commercial biological sampling program, we recommend resources be allocated to investigating and comparing other approaches for providing catch advice for Pacific Cod stocks.
This may include length-based [e.g., @haist1995; @haist1998] or production model [e.g., @mildenberger2019] methods or an even more data-limited approach, such as adjusting annual TACs based on changes in the survey indices.
Versions of the latter approach are used by the International Council for the Exploration of the Sea (ICES) for data-limited (Category 3) stocks [@ices2022].
In Canada, survey-based data-limited methods have been simulation-tested in the Groundfish Management Procedure Framework [@anderson2021] and in @huynh2020.
-->


\clearpage

# References {-}

<!-- This allows appendices to appear after the references -->
<div id="refs"></div>

\clearpage

# Tables

```{r surv-canadian-table, results='asis'}
dplyr::filter(dat$survey_index, survey_abbrev %in%
  c("SYN WCVI")) %>%
  dplyr::select(survey_abbrev, year, biomass, re, lowerci, upperci, num_sets, num_pos_sets) %>%
  dplyr::mutate(lowerci = round(lowerci/1000, 1), upperci = round(upperci/1000, 1),
    biomass = round(biomass/1000, 1), re = round(re, 2)) %>%
  dplyr::rename(`Survey abbrev.` = survey_abbrev, Year = year, Biomass = biomass,
    CV = re, `Lower CI` = lowerci, `Upper CI` = upperci, Sets = num_sets, `Positive sets` = num_pos_sets) %>%
  dplyr::arrange(`Survey abbrev.`, Year) %>%
  knitr::kable(caption = "Pacific Cod survey data for the WCVI synoptic trawl survey (SYN WCVI) in metric tons (without accounting for survey catchability). Positive sets refers to the number of trawl sets that caught Pacific Cod.", booktabs = TRUE, linesep = "",
    format = "pandoc")
```

\clearpage

```{r tab-catch-3cd}
catch.table(catch.3,
            catch.3.discards,
            pre.1996.discards.3cd,
            area = "3CD",
 cap = paste0("Reported catch (mt) of Pacific Cod in Area 3CD ",
              "by Canada and the USA, ",
              min(catch.3$year)+3, "--", max(catch.3$year),
              ". The reported releases at sea (discards) for the period ", min(catch.3$year)+3,
              "--1995 are ",
              "likely unrepresentative of true discarding because the estimates were taken ",
              "from logbooks in the absence of observers. Discard estimates since 1996 are based on at-sea ",
              "observations and are considered to be more representative of true discarding. Numbers are rounded for presentation."), french=french)
```

\clearpage

```{r tab-mean-weight-recent-3cd, results='asis'}
mw.table(c(base.model.3cd,
           sens.models.11),
         c(base.model.3cd.name,
           sens.models.name.11),
         years=2010:2022,
         area="3CD",
         caption="Comparison of mean weight values used in the four commercial mean weight scenarios. Methods for scenario descriptions.")

```

\clearpage

```{r tab-est-recruit-3cd, results='asis'}

make.value.table.compare(c(base.model.3cd,
                           sens.models.11),
                 c(base.model.3cd.name,
                   sens.models.name.11),
                 years=2010:2022,
                 type= 2,
                 mpdmed="med",
                 caption = "Comparison of recent median posterior recruitment estimates from the four commercial mean weight scenarios. See Methods for scenario descriptions.")

```


```{r tab-est-recruit-3cd-per, results='asis'}
make.value.table.compare(c(base.model.3cd,
                           sens.models.11),
                 c(base.model.3cd.name,
                   sens.models.name.11),
                 years=2010:2022,
                 type= 2,
                 mpdmed="med",
                 caption = "Comparison of percentage difference in median posterior recruitment estimates from the four commercial mean weight scenarios. See Methods for scenario descriptions. Scenario 1 is used as the reference.",
                 percent=TRUE)

```

\clearpage

```{r tab-est-biomass-3cd, results='asis'}
make.value.table.compare(c(base.model.3cd,
                           sens.models.11),
                 c(base.model.3cd.name,
                   sens.models.name.11),
                 years=2010:2022,
                 type= 1,
                 mpdmed="med",
                 caption = "Comparison of recent median posterior biomass estimates from the four commercial mean weight scenarios. See Methods for scenario descriptions.")

```

```{r tab-est-biomass-3cd-per, results='asis'}
make.value.table.compare(c(base.model.3cd,
                           sens.models.11),
                 c(base.model.3cd.name,
                   sens.models.name.11),
                 years=2010:2022,
                 type= 1,
                 mpdmed="med",
                 caption = "Comparison of percentage difference in median posterior biomass estimates from the four commercial mean weight scenarios. See Methods for scenario descriptions.  Scenario 1 is used as the reference.",
                 percent=TRUE)

```

<!--
\clearpage

```{r summary-tab-stock-status-avg-3cd, results='asis'}
stock.status(avg.model.3cd,
                caption = paste0("Current stock status with model averaging. Models averaged are: ",
                                 and.string(c(base.model.3cd.name, sens.models.name.13.sub)),
                                 "."), french=french) #
```

```{r summary-tab-projection-zero-avg-3cd, results='asis'}
decision.table.zero.tac(avg.model.3cd,
               caption = paste0("Probabilities of stock breaching reference points under TAC = 0 for a one-year projection, with model averaging. See Table 8 caption for scenario descriptions"),
               french=french) #
```

<!--

Don't include a decision table

```{r summary-tab-decision-avg-3cd, results='asis'}
 decision.table(avg.model.3cd,
                caption = paste0("Decision table with model averaging. Models averaged are: ",
                                 and.string(c(base.model.3cd.name, sens.models.name.13.sub)),
                                 "."), french=french) #
```

-->


\clearpage

# Figures

```{r surv-canadian, fig.cap="Pacific Cod survey data for the West Coast Vancouver Island synoptic bottom trawl survey (SYN WCVI), showing relative biomass and associated lower and upper confidence intervals. Positive sets refers to the number of trawl sets that caught Pacific Cod."}
gfplot::tidy_survey_index(dat$survey_index,
  survey = "SYN WCVI") %>%
  plot_survey_index(french=french)
```

```{r fig-catch-3cd, fig.cap="Catch for Area 3CD. Canadian catch includes at-sea releases."}
make.catches.plot(catch.3, french=french) +
  scale_y_continuous(labels = comma,
                       limits = c(0, NA))
```

```{r fig-modern-cpue-3cd, fig.cap="Pacific Cod commercial CPUE. Red series shows the fully standardized model described in Forrest et al. (2020). The geometric mean of the raw data (no standardization) is shown with the dashed line."}
knitr::include_graphics(file.path(generatedd,paste0("CPUE_Modern_Fully_Standardized_3CD.png")))

```

\clearpage

```{r fig-base-mean-weight-3cd, fig.cap="Scenario 1 model MPD fit to the mean weight data. See Methods for scenario descriptions."}
plot_grid(mw.plot(base.model.3cd[[1]], cv = 0.2, every = 10, last.yr = 2022, french=french),
          mw.compare.plot(base.model.3cd[[1]], french=french),
          nrow = 1,
          ncol = 2)
```

```{r fig-base-mean-weight-3cd-sc2, fig.cap="Scenario 2 model MPD fit to the mean weight data. See Methods for scenario descriptions."}
plot_grid(mw.plot(sens.models.11[[1]], cv = 0.2, every = 10, last.yr = 2022, french=french),
          mw.compare.plot(sens.models.11[[1]], french=french),
          nrow = 1,
          ncol = 2)
```

```{r fig-base-mean-weight-3cd-sc3, fig.cap="Scenario 3 model MPD fit to the mean weight data. See Methods for scenario descriptions."}
plot_grid(mw.plot(sens.models.11[[2]], cv = 0.2, every = 10, last.yr = 2022, french=french),
          mw.compare.plot(sens.models.11[[2]], french=french),
          nrow = 1,
          ncol = 2)
```

```{r fig-base-mean-weight-3cd-sc4, fig.cap="Scenario 4 model MPD fit to the mean weight data. See Methods for scenario descriptions."}
plot_grid(mw.plot(sens.models.11[[3]], cv = 0.2, every = 10, last.yr = 2022, french=french),
          mw.compare.plot(sens.models.11[[3]], french=french),
          nrow = 1,
          ncol = 2)
```

\clearpage

```{r fig-sens-recr-3cd, fig.cap="Sensitivity of recruitment estimates to commercial mean weight scenarios. Points shows the posterior medians and the bars represent the 95\\% credible interval. See Methods for scenario descriptions. The lower panel is zoomed in to 2015--2022.", fig.asp=.9}
g1 <- r.plot(c(base.model.3cd, sens.models.11), c(base.model.3cd.name, sens.models.name.11))
g2 <- r.plot(c(base.model.3cd, sens.models.11), c(base.model.3cd.name, sens.models.name.11)) +
  coord_cartesian(xlim = c(2015, 2022), ylim = c(0, 7000)) +
  scale_x_continuous(breaks = 2015:2022)
cowplot::plot_grid(g1, g2, ncol = 1, align = "v")
```

```{r fig-sens-biomass-3cd, fig.cap="Sensitivity of biomass estimates to commercial mean weight scenarios. Thick solid lines shows the posterior medians and the grey shaded regions represent the 95\\% credible interval. See Methods for scenario descriptions. The lower panel is zoomed in to 2015--2022.", fig.asp=.9}
g1 <- b.plot(c(base.model.3cd, sens.models.11), c(base.model.3cd.name, sens.models.name.11))
g2 <- b.plot(c(base.model.3cd, sens.models.11), c(base.model.3cd.name, sens.models.name.11)) +
    coord_cartesian(xlim = c(2015, 2022), ylim = c(0, 30000)) +
  scale_x_continuous(breaks = 2015:2022)
cowplot::plot_grid(g1, g2, ncol = 1, align = "v")
```

<!--
\clearpage

```{r fig-sens-biomass-3cd-all-avg, fig.cap="Sensitivity of biomass estimates to the the seven sensitivity cases used for model-averaging. Thick solid lines shows the posterior medians and the grey shaded regions represent the 95\\% credible interval. All models use the commercial mean weight index used in Sc. 1 (see Methods)."}
b.plot(c(base.model.3cd, desc.models.3cd), c(base.model.3cd.name, desc.models.3cd.name))
```

```{r fig-sens-recr-3cd-all-avg, fig.cap="Sensitivity of recruitment estimates to the seven sensitivity cases used for model-averaging. Points shows the posterior medians and the bars represent the 95\\% credible interval. All models use the commercial mean weight index used in Sc. 1 (see Methods)."}
r.plot(c(base.model.3cd, desc.models.3cd), c(base.model.3cd.name, desc.models.3cd.name))
```

\clearpage

```{r fig-model-average-biomass-3cd, fig.cap="Combined posterior biomass for the model-averaged set. Thick solid line shows the posterior median and the grey shaded region represents the 95\\% credible interval. Green dashed line shows the median USR; red dashed line shows the median LRP. Red and green shaded intervals represent the 95\\% credible interval of the LRP and USR, respectively."}
b.plot(avg.model.3cd,
       base.model.3cd.name,
       depl = FALSE,
       add.hist.ref = TRUE,
       lrp = c(1986, 1986),
       usr = c(1956, 2004), french=french)

```


```{r fig-model-average-f-3cd, fig.cap="Combined posterior fishing mortality for the model-averaged set. Thick solid line shows the posterior median and the shaded region represents the 95\\% credible interval. Black dashed line shows the median LRR and the horizontal shaded region represents the 95\\% credible interval."}
f.plot(avg.model.3cd,
       base.model.3cd.name,
       add.hist.ref = TRUE,
       lrr = c(1956, 2004),
       french=french)

```


```{r fig-model-average-biomass-3cd-rel, fig.cap="Combined posterior biomass over biomass at the USR and biomass at the LRP for the model-averaged set. Thick solid line shows the posterior median and the grey shaded regions represent the 50\\% and 95\\% credible intervals. Horizontal dashed line represents a ratio of 1.", fig.asp=1}
x <- avg.model.3cd[[1]]$mcmccalcs$sbt.dat
x <- as.data.frame(x)
x$iter <- seq_len(nrow(x))
x <- tidyr::pivot_longer(x, cols = -iter, names_to = "year", values_to = "b") %>%
  mutate(year = as.integer(year))
lrp <- filter(x, year == 1986L) %>% rename(lrp = b) %>% select(-year)
x <- left_join(x, lrp)
usr <- filter(x, year %in% seq(1956, 2004)) %>%
  group_by(iter) %>%
  summarise(usr = mean(b))
x <- left_join(x, usr) |> 
  mutate(b_lrp = b / lrp, b_usr = b / usr) |> 
  filter(year <= 2023)

g <- x |> 
  group_by(year) |> 
  summarise(lwr = quantile(b_lrp, probs = 0.025), upr = quantile(b_lrp, probs = 0.975), lwr2 = quantile(b_lrp, probs = 0.25), upr2 = quantile(b_lrp, probs = 0.75), med = median(b_lrp)) |> 
  ggplot(aes(year, med, ymin = lwr, ymax = upr)) +
  geom_ribbon(fill = "grey90") +
  geom_ribbon(aes(ymin = lwr2, ymax = upr2), fill = "grey75") +
  geom_line() +
  geom_hline(yintercept = 1, lty = 2, col = "grey50") +
  coord_cartesian(xlim = range(x$year), ylim = c(0, NA), expand = FALSE) +
  ylab("B / LRP") + xlab("Year")

g1 <- x |> 
  group_by(year) |> 
  summarise(lwr = quantile(b_usr, probs = 0.025), upr = quantile(b_usr, probs = 0.975), lwr2 = quantile(b_usr, probs = 0.25), upr2 = quantile(b_usr, probs = 0.75), med = median(b_usr)) |> 
  ggplot(aes(year, med, ymin = lwr, ymax = upr)) +
  geom_ribbon(fill = "grey90") +
  geom_ribbon(aes(ymin = lwr2, ymax = upr2), fill = "grey75") +
  geom_line() +
  geom_hline(yintercept = 1, lty = 2, col = "grey50") +
  coord_cartesian(xlim = range(x$year), ylim = c(0, NA), expand = FALSE) +
  ylab("B / USR") + xlab("Year")

cowplot::plot_grid(g1, g, ncol = 1, align = "v")
```

```{r fig-model-average-p-lrp, fig.cap="Probability of biomass being below the LRP from 2014 to 2023. The horizontal dashed line shows a threshold of 0.5 probability."}
x |> 
  group_by(year) |> 
  summarise(prob_lrp = mean(b_lrp < 1)) |> 
  ggplot(aes(year, prob_lrp)) +
  geom_line() +
  geom_hline(yintercept = .5, lty = 2, col = "grey50") +
  coord_cartesian(xlim = c(2014, 2023), ylim = c(0, 0.55), expand = FALSE) +
  ylab("P(B < LRP)") + xlab("Year") +
  scale_x_continuous(breaks = seq(2012, 2022, 2))
```
-->
\clearpage

# (APPENDIX) Appendix {-}

# Changes in commercial length sampling {#sec:AppendixA}

```{r get-length-samples-3cd}

comm_samp <- dat$commercial_samples %>%
  dplyr::filter(major_stat_area_name %in% c("3C: S.W. VANCOUVER ISLAND","3D: N.W. VANCOUVER ISLAND"),
                year>1995)

summary_by_year <- comm_samp %>%
  select(year,sample_id,length) %>%
  group_by(year) %>%
  summarize(nsamples=n_distinct(sample_id),
            nlengths=sum(!is.na(length)),
            meanlength=round(mean(length),2),
            sdlength=round(sd(length),2),
            selength=round(sdlength/sqrt(nlengths),2))

 colnames(summary_by_year) <- c("Year", "Num samples", "Num lengths","Raw mean length", "SD length", "SE length")

knitr::kable(summary_by_year,
               caption = "Summary of commercial length samples since 1996 for Area 3CD. Mean lengths are unweighted by catch and are presented to visualise changes in sampling effort since 2015.",
               longtable = TRUE, format = "pandoc",
               align = get.align(ncol(summary_by_year))[-1],
               booktabs = TRUE, linesep = "", escape = FALSE, row.names = FALSE) %>%
    kableExtra::kable_styling(latex_options = c("hold_position", "repeat_header"))

```

```{r plot-length-samples-3cd, fig.cap="Summary of raw commercial length samples since 2000 for Area 3CD, showing the anomalously high value in 2017. Mean lengths are unweighted by catch."}

g <- summary_by_year %>%
  dplyr::filter(Year>1999) %>%
  ggplot(aes(x=Year, y=`Raw mean length`))+
  geom_point(size=3)+
  geom_errorbar(aes(ymin=`Raw mean length`-`SE length`, ymax=`Raw mean length`+ `SE length`),  width=0.1)+
  labs(x = "Year", y = "Raw mean length (cm)")+
  gfplot::theme_pbs()+
  scale_color_viridis_d() +
  theme(plot.title = element_text(face="bold", size=14),
        axis.title.x = element_text(size=12),
        axis.title.y = element_text(size=12),
        axis.text.y = element_text(size=12),
        axis.text.x = element_text(size=10))

g

```

\clearpage

# Developing a survey mean weight index {#sec:AppendixB}

## Methods

We followed the steps in Appendix C of @forrest2020, which described the methodology for weighting the commercial length samples to produce a commercial annual mean weight index, weighted by sequential quarter and catch weight.

We also adapted the approach for the West Coast Vancouver Island Synoptic Survey by replacing weighting by sequential quarter, which was done for the commercial samples, with weighting by depth stratum (Equations 3 and 4).
This was done because the survey is depth-stratified.

Note that for the survey mean weight index, we derived weights of individual fish from the measured lengths, using published length-weight parameters rather than using weights that were directly measured (Equation 1).
This was because far more fish were measured than were weighed.
This also follows the approach used for the commercial mean weight index.

The calculation of the survey annual mean weight index was done in the following steps. For simplicity, we have dropped year subscripts.

1. For each specimen $i$, in each Sample ID $j$, in each depth stratum $s$, convert individual length ($L_{i,j,s}$)  to weight ($W_{i,j,s}$):

\begin{equation}
{W_{i,j,s}} = \alpha{L_{i,j,s}}^{\beta}
\end{equation}

where $\alpha$ and $\beta$ are constant length-weight parameters, where the values of the length-weight parameters are `r paste0("$\\alpha = ", .ALPHA3, "$")` and `r paste0("$\\beta = ", .BETA3, "$")`.

2. Calculate the mean weight ($W_j$) in each sample ID $j$, in each depth stratum $s$:

\begin{equation}
  {W_{j,s}} =  \frac{\sum\limits_{i=1}^{N_{j,s}}{{w_{i,j,s}}}}{{N_{j,s}}}
\end{equation}

where $N_{j,s}$ is the number of weights $W_{i,j,s}$ in sample ID $j$ and depth stratum $s$.

3. Calculate the mean weight ($W_s$) for each depth stratum $s$, weighted by the sample weights $S$:

\begin{equation}
{W_s} = \frac{{\sum\limits_{j=1}^{{N_s}} {{W_{j,s}S_{j,s}}}}}{{\sum\limits_{j=1}^{{N_s}} {{S_{j,s}}}}}
\end{equation}

where $N_s$ is the number of samples in depth stratum $s$.

4. Calculate the annual survey mean weight ($W$), weighted by the catch $C_s$ in each stratum $s$:

\begin{equation}
{W} = \frac{{\sum\limits_{s=1}^{{K}} {{W_sC_s}}}}{{\sum\limits_{s=1}^{{K}} {{C_s}}}}
\end{equation}

where $K$ is the number of depth strata surveyed in that year.

\clearpage

## Results

The commercial mean weight index, calculated using the method shown in Appendix C of @forrest2020 is shown in Figure \@ref(fig:fig-comm-mean-weights-3cd), which indicates number of sampling events for each index year, as well as the two index values that were removed due to low sampling effort (2017 and 2019, see Appendix A).

Figure \@ref(fig:fig-meas-vs-calc-weights-3cd) shows the relationship between observed weights obtained by directly weighing individual fish vs weights calculated using Equation 1.
Figure \@ref(fig:fig-comm-vs-survey-weights-3cd) shows the commercial mean weight index obtained from the methods described in @forrest2020, compared with the survey mean weight index obtained from Equations 1--4 here.
The number of sampling events is indicated by the sizes of the circles in Figures \@ref(fig:fig-comm-mean-weights-3cd) and \@ref(fig:fig-comm-vs-survey-weights-3cd).


```{r fig-comm-mean-weights-3cd, fig.cap="Time series of commercial mean weight series, calculated using methods shown in Forrest et al. 2020. Area of the circles indicates the number of sampling events. Black crosses indicate the 2017 and 2019 index values, which were removed from further analysis due to low sample sizes (see Appendix A). ", out.width="4in"}
knitr::include_graphics(here::here("data/generated/commercial_mean_weight_3CD.png"))
```

```{r fig-meas-vs-calc-weights-3cd, fig.cap="Observed vs. calculated weights from the WCVI survey; all years, all depth strata.", out.width="4in"}
knitr::include_graphics(here::here("data/generated/Measured_v_Calc_weights_survey3CD.png"))
```

```{r fig-comm-vs-survey-weights-3cd, fig.cap="Commercial mean weight index and survey mean weight index. Area of the circles indicates the number of sampling events. To aid visualization, the commercial mean weight index is truncated to begin in 2000.", out.width="4in"}
knitr::include_graphics(here::here("data/generated/Comm_v_Survey_weights_3CD.png"))
```

\clearpage

# Generalized Linear Model to predict commercial mean length index {#sec:AppendixC}

## Methods

We used a GLM with gamma-distributed observations and a log link [@mccullagh1989, p. 292], to estimate commercial mean weights ($y_t$) in year $t$ based on survey mean weights ($W_t$), calculated in Appendix B. Our model was fit as
\begin{align}
{y_t} \sim \mathrm{Gamma}(\phi, \mu_t / \phi), \\
\log(\mu_t) = \beta_0 + \beta_1 \log(W_t),
\end{align}

where $\mu_t$ represents the expected value at time $t$,
$\beta_0$ and $\beta_1$ represent an intercept and slope,
$\phi$ represents the gamma shape parameter,
and the term $\mu_t / \phi$ represents the gamma scale.
The shape parameter can be reparameterized into the coefficient of variation (CV) as $\phi = 1 / \mathrm{CV}^2$ or $\mathrm{CV} = 1 / \sqrt{\phi}$.

## Results

Figure \@ref(fig:fig-comm-vs-survey-weights-3cd-2) shows the commercial mean weight index plotted against the survey mean weight index, with the linear regression line.
The GLM estimated an intercept ($\beta_0$) of 0.34 (95% CI: 0.13--0.57), or 1.41 kg (95% CI: 1.14--1.76 kg) in natural space (Figure \@ref(fig:fig-comm-vs-survey-weights-3cd-2)).
The model estimated $\beta_1$ as 0.75 (95% CI: 0.25--1.17), meaning a 1% increase in survey mean weight was associated with a 0.75% (95% CI: 0.25%--1.17%) increase in commercial mean weight (Figure \@ref(fig:fig-comm-vs-survey-weights-3cd-2)).
The CV was estimated as 0.12.
A quantile-quantile plot of residuals transformed to have a Normal(0, 1) distribution if the model were consistent with the data did not reveal any substantial deviations from the expectation (Figure \@ref(fig:qqnorm-glm)).

Figure \@ref(fig:all-mean-weight-series-3cd) shows time series of all three series: the survey mean weight index, observed commercial mean weight index, and predicted mean weight index from the GLM, indicating good agreement between the commercial and survey mean weight indices.
The predicted commercial mean weights fit the observed commercial mean weights almost perfectly between 2004 and 2010, and in 2014.
The predictions underestimated the observed commercial index in 2012 and, following the survey trend, overestimated the commercial index in 2016.

```{r fig-comm-vs-survey-weights-3cd-2, fig.cap="Commercial mean weight index vs. survey mean weight index. The solid line indicates the GLM mean; the dark and light grey shading indicates 50\\% and 95\\% confidence intervals. The area of the circles indicates the number of sampling events and the colour indicates the year.", out.width="4.2in"}
knitr::include_graphics(here::here("data/generated/lnSurvey_v_lnCom_with_lm_fit_3CD.png"))
```

```{r qqnorm-glm, fig.cap="Quantile-quantile plot of the GLM predicting commercial mean weight from survey mean weight. The residuals have been transformed to be Normal(0, 1) if the model were consistent with the data. The line indicates the one-to-one line.", out.width="2.6in"}
knitr::include_graphics(here::here("data/generated/qq-resids3CD.png"))
```

```{r all-mean-weight-series-3cd, fig.cap="Comparison of the survey mean weight index, observed commercial mean weight index, and predicted commercial mean weight index from the GLM. For visualization purposes, the observed commercial mean weight index is truncated to begin in 2004, which is the year of the first WCVI Synoptic Survey.", out.width="5in"}
knitr::include_graphics(here::here("data/generated/Compare_Obs_v_Predicted_Weight3CD.png"))
```

\clearpage

# Model diagnostics {#sec:AppendixD}

Here we provide model diagnostics for Sc. 1, the first of the commercial mean weight scenarios, which is also used as the base model in the model-averaged set of models.
For brevity, we do not show full diagnostics for the other models, only the index fits.

## Sc. 1 Diagnostics

```{r tab-param-est-table-3cd-diag, results='asis'}
pars_est_omit <- c("$\\overline{R}_{init}$", "$\\overline{R}$", "$\\vartheta$")
make.parameters.est.table(base.model.3cd,
  caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
    "97.5\\textsuperscript{th} percentile) and MPD ",
    "estimates of key parameters from Sc.1. $R_0$ is in thousands of fish. $B_0$ is in tonnes. ",
    q.3cd.desc),
  omit_pars = pars_est_omit)
```

```{r fig-base-index-fits-3cd-diag, fig.cap="MPD fits to observed indices of abundance (points) for Sc. 1 from (a) the West Coast Vancouver Island Synoptic Survey, (b) the Commercial CPUE pre-1996, (c) the Commercial CPUE post-1995, and (d) the NMFS Triennial Survey (Canadian portion)."}
plot_grid(i.plot(base.model.3cd, base.model.3cd.name, 1, every = 5),
          i.plot(base.model.3cd, base.model.3cd.name, 2, every = 5)
            + ylab("Commercial CPUE (kg/hour)"),
          i.plot(base.model.3cd, base.model.3cd.name, 3, every = 5)
            + ylab("Commercial CPUE (kg/hour)"),
          i.plot(base.model.3cd, base.model.3cd.name, 4, every = 5),
          nrow = 2,
          ncol = 2,
          labels = c("(a)", "(b)", "(c)", "(d)"),
          label_x = c(0.15, 0.13, 0.13, 0.2))
```

```{r fig-base-catch-fit-3cd-diag, fig.cap="MPD fit to the catch data for Sc. 1. For clarity, only MPD results are shown."}
catch.fit.plot(base.model.3cd, every = 5, last.yr = 2020)
```

(ref:priorpostcaption3cd) Histograms of posterior samples with prior probability distributions (lines) used in Sc. 1. MPD estimate shown as vertical dashed line. Note that the West Coast Vancouver Island Synoptic Survey used a normal prior distribution on $ln(q)$.

```{r fig-base-mcmc-priors-posts-3cd, fig.cap=paste("(ref:priorpostcaption3cd)")}
make.priors.posts.plot(base.model.3cd, priors.only = FALSE)
```

```{r fig-base-mcmc-pairs-3cd, fig.cap=paste0("Pairs plots of posterior samples for Sc. 1. ", q.3cd.desc)}
make.pairs.plot(base.model.3cd)
```


```{r fig-base-mcmc-trace-3cd, fig.cap=paste0("Traceplots of posterior samples for Sc. 1. ", q.3cd.desc)}
make.traces.plot(base.model.3cd)
```

```{r fig-base-mcmc-autocor-3cd, fig.cap=paste0("Autocorrelation plots for for Sc. 1. ", q.3cd.desc)}
make.autocor.plot(base.model.3cd)
```

\clearpage

## Fits to the indices of abundance for sensitivity analyses

### Commercial annual mean weight index scenarios.

```{r fig-sens11-index-wcviss-3cd, fig.cap="MPD index fits showing sensitivity to the four commercial mean weight scenarios, WCVI Synoptic Survey."}
i.plot(c(base.model.3cd, sens.models.11), c(base.model.3cd.name, sens.models.name.11), ind = 1, leg.loc = "topleft")
```

```{r fig-sens11-index-triennial-3cd, fig.cap="MPD index fits showing sensitivity to the four commercial mean weight scenarios, NMFS Triennial survey."}
i.plot(c(base.model.3cd, sens.models.11), c(base.model.3cd.name, sens.models.name.11), ind = 4)
```

```{r fig-sens11-index-cpue-pre1996-3cd, fig.cap="MPD index fits showing sensitivity to the four commercial mean weight scenarios, commercial CPUE pre-1996."}
i.plot(c(base.model.3cd, sens.models.11), c(base.model.3cd.name, sens.models.name.11), ind = 2, every = 5) +
  ylab("Commercial CPUE (kg/hour)")
```

```{r fig-sens11-index-cpue-post1995-3cd, fig.cap="MPD index fits showing sensitivity to the four commercial mean weight scenarios, commercial CPUE post-1995."}
i.plot(c(base.model.3cd, sens.models.11), c(base.model.3cd.name, sens.models.name.11), ind = 3, leg.loc = "topleft") + ylab("Commercial CPUE (kg/hour)")
```

<!--
\clearpage

### Model-averaging scenarios


```{r fig-sens13-index-wcviss-3cd, fig.cap="MPD index fits showing sensitivity to the assumed value of observation and process errors, WCVISS, Area 3CD."}
i.plot(desc.models.3cd, desc.models.3cd.name, ind = 1, leg.loc = "topleft")
```

```{r fig-sens13-index-triennial-3cd, fig.cap="MPD index fits showing sensitivity to the assumed value of observation and process errors, NMFS Triennial survey, Area 3CD."}
i.plot(desc.models.3cd, desc.models.3cd.name, ind = 4)
```

```{r fig-sens13-index-cpue-pre1996-3cd, fig.cap="MPD index fits showing sensitivity to the assumed value of observation and process errows, commercial CPUE pre-1996, Area 3CD."}
i.plot(desc.models.3cd, desc.models.3cd.name, ind = 2, every = 5) +
  ylab("Commercial CPUE (kg/hour)")
```

```{r fig-sens13-index-cpue-post1995-3cd, fig.cap="MPD index fits showing sensitivity to the assumed value of observation and process errors, commercial CPUE post-1995, Area 3CD."}
i.plot(desc.models.3cd, desc.models.3cd.name, ind = 3, leg.loc = "topleft") + ylab("Commercial CPUE (kg/hour)")
```

-->
